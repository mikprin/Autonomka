<!DOCTYPE html>
<html dir="ltr" lang="en-gb">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Firmware stuff - Page 3 - A Forum at Sky's Edge</title>

	<link rel="alternate" type="application/atom+xml" title="Feed - A Forum at Sky's Edge" href="/forum/app.php/feed">			<link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="/forum/app.php/feed/topics">		<link rel="alternate" type="application/atom+xml" title="Feed - Forum - Rotary Cell Phone Kit Community Forum" href="/forum/app.php/feed/forum/4">	<link rel="alternate" type="application/atom+xml" title="Feed - Topic - Firmware stuff" href="/forum/app.php/feed/topic/1486">	
	<link rel="canonical" href="http://skysedge.us/forum/viewtopic.php?t=1486&amp;start=20">

<!--
	phpBB style name: prosilver
	Based on style:   prosilver (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:
-->

<link href="./assets/css/font-awesome.min.css?assets_version=6" rel="stylesheet">
<link href="./styles/prosilver/theme/stylesheet.css?assets_version=6" rel="stylesheet">
<link href="./styles/prosilver/theme/en/stylesheet.css?assets_version=6" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/prosilver/theme/tweaks.css?assets_version=6" rel="stylesheet">
<![endif]-->





</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">


<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>
	<div id="page-header">
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description" class="site-description">
		<a id="logo" class="logo" href="./index.php" title="Board index">
					<span class="site_logo"></span>
				</a>
				<h1>A Forum at Sky's Edge</h1>
				<p>Community Forum for Sky&#039;s Edge Hardware</p>
				<p class="skiplink"><a href="#start_here">Skip to content</a></p>
			</div>

									<div id="search-box" class="search-box search-header" role="search">
				<form action="./search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="./search.php" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</div>
						
			</div>
					</div>
				<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="./search.php?search_id=unanswered" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-gray" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="./search.php?search_id=active_topics" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-blue" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="./search.php" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
										<li class="separator"></li>

									</ul>
			</div>
		</li>

				<li data-skip-responsive="true">
			<a href="/forum/app.php/help/faq" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
						
			<li class="rightside"  data-skip-responsive="true">
			<a href="./ucp.php?mode=login&amp;redirect=viewtopic.php%3Ff%3D4%26p%3D1608%26t%3D1486" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
					<li class="rightside" data-skip-responsive="true">
				<a href="./ucp.php?mode=register" role="menuitem">
					<i class="icon fa-pencil-square-o  fa-fw" aria-hidden="true"></i><span>Register</span>
				</a>
			</li>
						</ul>

	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
								<li class="breadcrumbs" itemscope itemtype="http://schema.org/BreadcrumbList">
										<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope><a href="./index.php" itemtype="https://schema.org/Thing" itemscope itemprop="item" accesskey="h" data-navbar-reference="index"><i class="icon fa-home fa-fw"></i><span itemprop="name">Board index</span></a><meta itemprop="position" content="1" /></span>

																			<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope data-forum-id="4"><a href="./viewforum.php?f=4" itemtype="https://schema.org/Thing" itemscope itemprop="item"><span itemprop="name">Rotary Cell Phone Kit Community Forum</span></a><meta itemprop="position" content="2" /></span>
												</li>
		
					<li class="rightside responsive-search">
				<a href="./search.php" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
			</ul>

	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		
<h2 class="topic-title"><a href="./viewtopic.php?f=4&amp;t=1486&amp;start=20">Firmware stuff</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Discuss building and using the 3G rotary cell phone kit. If you're seeking help or would like to help others, this is the place to post.<br /></div>


<div class="action-bar bar-top">
	
			<a href="./posting.php?mode=reply&amp;f=4&amp;t=1486" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="./viewtopic.php?f=4&amp;t=1486&amp;start=20&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="./search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="./search.php" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="1486" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			27 posts
							<ul>
			<li class="arrow previous"><a class="button button-icon-only" href="./viewtopic.php?f=4&amp;t=1486&amp;start=10" rel="prev" role="button"><i class="icon fa-chevron-left fa-fw" aria-hidden="true"></i><span class="sr-only">Previous</span></a></li>
				<li><a class="button" href="./viewtopic.php?f=4&amp;t=1486" role="button">1</a></li>
				<li><a class="button" href="./viewtopic.php?f=4&amp;t=1486&amp;start=10" role="button">2</a></li>
			<li class="active"><span>3</span></li>
	</ul>
					</div>
		</div>




			<div id="p1600" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile1600">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="./memberlist.php?mode=viewprofile&amp;u=2" style="color: #AA0000;" class="username-coloured">justine</a>							</dt>

						<dd class="profile-rank">Site Admin</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="./search.php?author_id=2&amp;sr=posts">27</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sun Feb 23, 2020 2:34 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content1600">

						<h3 class="first"><a href="./viewtopic.php?p=1600#p1600">Re: Firmware stuff</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="./posting.php?mode=quote&amp;f=4&amp;p=1600" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="./viewtopic.php?p=1600#p1600" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="./memberlist.php?mode=viewprofile&amp;u=2" style="color: #AA0000;" class="username-coloured">justine</a></strong> &raquo; </span><time datetime="2020-06-12T13:20:35+00:00">Fri Jun 12, 2020 1:20 pm</time>
			</p>
			
			
			
			<div class="content">Steve et al,<br>
<br>
I just wanted to say thank you for all your effort and attention. I've been swamped lately getting in a proposal for my day job and I'm trying to get back to phone stuff. Also have pre-existing robotics stuff for Sky's Edge that I need to get off my plate. But anyway, I'm really happy to see this activity and will <em class="text-italics">eventually</em> catch up on all the progress.<br>
<br>
~Justine</div>

			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p1601" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile1601">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="./memberlist.php?mode=viewprofile&amp;u=1749" class="username">chaza</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="./search.php?author_id=1749&amp;sr=posts">10</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Apr 29, 2020 8:54 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content1601">

						<h3 ><a href="./viewtopic.php?p=1601#p1601">Re: Firmware stuff</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="./posting.php?mode=quote&amp;f=4&amp;p=1601" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="./viewtopic.php?p=1601#p1601" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="./memberlist.php?mode=viewprofile&amp;u=1749" class="username">chaza</a></strong> &raquo; </span><time datetime="2020-06-12T21:04:05+00:00">Fri Jun 12, 2020 9:04 pm</time>
			</p>
			
			
			
			<div class="content">Thanks Steve -- I should have known about that Code block format but have not used it (don't do much posting) -- will use in the future. <br>
I just checked and putting the pinMode(SS, INPUT) at the end of setup() is sufficient by itself. So, it looks like once the display is initialized then it is unaffected by this. I will do some more testing but so far this seems ok. As I mentioned, I can see very little on my display at the moment (!) but from what I see there, and from serial output to a terminal, the reading of the serial output from the FONA is ok.</div>

			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p1604" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile1604">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="./memberlist.php?mode=viewprofile&amp;u=1748" class="username">paedipod</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="./search.php?author_id=1748&amp;sr=posts">13</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sat Apr 25, 2020 2:26 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content1604">

						<h3 ><a href="./viewtopic.php?p=1604#p1604">Re: Firmware stuff</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="./posting.php?mode=quote&amp;f=4&amp;p=1604" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="./viewtopic.php?p=1604#p1604" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="./memberlist.php?mode=viewprofile&amp;u=1748" class="username">paedipod</a></strong> &raquo; </span><time datetime="2020-06-14T20:46:44+00:00">Sun Jun 14, 2020 8:46 pm</time>
			</p>
			
			
			
			<div class="content">Hi All,<br>
<br>
Away for a while....after wrecking my display, the new one(s) arrived from AliExpress on Friday. So, removed and reinstalled (thanks SteveC for the tips posted elsewhere, I can now case/uncase the phone in minutes instead of hours.)<br>
<br>
Anyway thanks chaza for the "solution" to the pin problem. I too am a little under skilled for soldering a 0.2mm wire to anything. Things seem to be working so far.....although have not been able to make the missed call function work. <br>
<br>
And thanks SteveC for posting everything up here and in GitHub, although I don't think that I can use the fork without the hardware modification. Seems like the battery level and signal strength now working as intended.  I have the date display working but still getting the time as  00:00.<br>
<br>
So much improved functionality since last check in....now to start bending the display!</div>

			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p1605" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile1605">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="./memberlist.php?mode=viewprofile&amp;u=1724" class="username">SteveC</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="./search.php?author_id=1724&amp;sr=posts">56</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sat Mar 21, 2020 1:26 pm</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Cambridge</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content1605">

						<h3 ><a href="./viewtopic.php?p=1605#p1605">Re: Firmware stuff</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="./posting.php?mode=quote&amp;f=4&amp;p=1605" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="./viewtopic.php?p=1605#p1605" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="./memberlist.php?mode=viewprofile&amp;u=1724" class="username">SteveC</a></strong> &raquo; </span><time datetime="2020-06-14T22:22:41+00:00">Sun Jun 14, 2020 10:22 pm</time>
			</p>
			
			
			
			<div class="content">Hi Justine, good to see you back. I guessed you must be very busy and also working on the 4G kit but between all of us here we're getting the 3G model covered.<br>
<br>
This evening I modded my spare board so the FONA Tx pin is wired to the original Arduino digital pin 53. I modified my simple test sketch (posted earlier on this forum) to variously; set SS pinMode, initialise display, write display, on different button pushes.<br>
<br>
I confirmed/discovered [updated]:
<ul>
<li>the ATmega SS pin mode is set to output high as soon as display.init is called</li>
<li>setting pinMode(SS, INPUT_PULLUP); does remove the conflict*, the FONA can send to the ATmega (thanks Chaza)</li>
<li>the display stops working if SS is pulled low during a display update.</li>
</ul>

* It's important to keep this pin high, especially when the FONA is not installed (if it is, the pullup won't hurt anyway). Fortunately the idle state for 'RS232 TTL serial' is defined as 1.<br>
<br>
Please don't blame the messenger! I really want this to work without a board hardware mod.<br>
<br>
There's probably a workaround, perhaps some direct register setting to change SPI back to master (as well as SS pinMode). I'll have a look when I get the chance but I can't promise anything. But there's a risk of something adverse happening if the FONA Tx sends data during a display update. In this case the ATmega SPI switches from master to slave and the display will fail to update. There's nothing we can do about this mode switching, its hardcoded in the ATmega.<br>
<br>
If anyone is nervous about the wire change but is going to try anyway (i.e. don't blame me), I have two suggestions;<br>
<br>
<strong class="text-strong">The neat way:</strong><br>
This is the method I used (see photos in my GitHub fork). Don't slice the track, press the tip of a scapel down, more like a chisel than a knife, scrape the solder resist off the via as gently as possible so as not to break the through hole connection. I find a x6 illuminated magnifier works well for me (a good compromise between magnification and working distance) and I have a needle tipped soldering iron.<br>
<br>
<strong class="text-strong">The other way:</strong><br>
Destroy the via connection to hardware pin 19 (the SS pin), either cut the track or destroy the via through hole with a 0.8mm drill. Take a fine connecting wire (excess mic lead works) from the ATmega hardware pin 25 (corner pins are less tricky to solder) direct to the header pad for the FONA Tx pin. But you can't easily go back with this method.<br>
<br>
<strong class="text-strong">Update:</strong> the SPI can be switched back to master with:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>SPCR |= (1&lt;&lt;MSTR);</code></pre></div>
However This is not enough because when the FONA pulls SS low during a display update, the ATmega hangs. There's the SPIF interrupt to sort out and clear. From the ATmega2560 datasheet:  <em class="text-italics">If SS is an input and is driven low when the SPI is in Master mode, this will also set the SPIF Flag.</em><br>
<br>
<strong class="text-strong">Further reading:</strong><br>
<a href="http://maxembedded.com/2013/11/the-spi-of-the-avr/#SS" class="postlink">maxembedded.com/2013/11/the-spi-of-the-avr</a><br>
<a href="http://ww1.microchip.com/downloads/en/DeviceDoc/ATmega640-1280-1281-2560-2561-Datasheet-DS40002211A.pdf" class="postlink">ATmega2560 datasheet. See section 21.1, SS' Pin Functionality</a></div>

			
			
													<div class="notice">
					Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=1724" class="username">SteveC</a> on Tue Jun 16, 2020 12:29 am, edited 1 time in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p1608" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile1608">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="./memberlist.php?mode=viewprofile&amp;u=1724" class="username">SteveC</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="./search.php?author_id=1724&amp;sr=posts">56</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sat Mar 21, 2020 1:26 pm</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Cambridge</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content1608">

						<h3 ><a href="./viewtopic.php?p=1608#p1608">Re: Firmware stuff</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="./posting.php?mode=quote&amp;f=4&amp;p=1608" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="./viewtopic.php?p=1608#p1608" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="./memberlist.php?mode=viewprofile&amp;u=1724" class="username">SteveC</a></strong> &raquo; </span><time datetime="2020-06-15T20:31:45+00:00">Mon Jun 15, 2020 8:31 pm</time>
			</p>
			
			
			
			<div class="content"><strong class="text-strong">The short answer!</strong><br>
<br>
If not rewiring the FONA Tx pin, then insert:<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>pinMode(SS, INPUT_PULLUP);  // Set SS' pin as input, the pullup ensures this doesn't halt the ATmega if the pin is floating low (no FONA)</code></pre></div>

after <em class="text-italics">display.init(115200);</em> but note the ATmega halts if SS is pulled low during a display update.</div>

			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p1609" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile1609">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="./memberlist.php?mode=viewprofile&amp;u=1724" class="username">SteveC</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="./search.php?author_id=1724&amp;sr=posts">56</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sat Mar 21, 2020 1:26 pm</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Cambridge</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content1609">

						<h3 ><a href="./viewtopic.php?p=1609#p1609">Re: Firmware stuff</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="./posting.php?mode=quote&amp;f=4&amp;p=1609" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="./viewtopic.php?p=1609#p1609" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="./memberlist.php?mode=viewprofile&amp;u=1724" class="username">SteveC</a></strong> &raquo; </span><time datetime="2020-06-16T12:05:53+00:00">Tue Jun 16, 2020 12:05 pm</time>
			</p>
			
			
			
			<div class="content">This might work (for unmodified boards) but it's a bit of a kludge:<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>// Put this with the other includes near the top of the sketch
#include &lt;Adafruit_SleepyDog.h&gt;

// Put this in setup()
int countdownMS = Watchdog.enable(4000);

// Either put this immediately after display.init(115200);
pinMode(SS, INPUT_PULLUP);
// or this, if you're sure the board will never be tested without a FONA
pinMode(SS, INPUT);

// Put this somewhere in loop() where it will be called once per loop
Watchdog.reset();
</code></pre></div>

The pinMode instruction removes the conflict between FONA Tx and SPI SS but does not avoid lockup when SS is pulled low during a display update.<br>
<br>
The rest of the code resets the board if the ATmega locks up. A full display update takes almost 3s so a watchdog timeout of 4s is about right.<br>
<br>
However I won't be supporting this. The more reliable option is to solder a new connection for FONA Tx which is what I've done with my boards. Any firmware I develop will require this hardware mod.</div>

			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p1613" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile1613">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="./memberlist.php?mode=viewprofile&amp;u=1724" class="username">SteveC</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="./search.php?author_id=1724&amp;sr=posts">56</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sat Mar 21, 2020 1:26 pm</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Cambridge</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content1613">

						<h3 ><a href="./viewtopic.php?p=1613#p1613">Re: Firmware stuff</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="./posting.php?mode=quote&amp;f=4&amp;p=1613" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="./viewtopic.php?p=1613#p1613" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="./memberlist.php?mode=viewprofile&amp;u=1724" class="username">SteveC</a></strong> &raquo; </span><time datetime="2020-07-10T14:42:02+00:00">Fri Jul 10, 2020 2:42 pm</time>
			</p>
			
			
			
			<div class="content"><strong class="text-strong">Doubling battery life</strong><br>
<br>
I just achieved 48 hour battery life by allowing the FONA to go to idle. Idle state is possible by forcing the FONA Rx pin low (normal RS232 idle state is high). While in idle the FONA consumes approx 5mA (depending on RF band), it will still receive calls and send URCs (Unsolicited Response Codes) on the Tx pin, e.g. caller ID.<br>
<br>
The FONA is woken up and able to receive commands over it's UART by setting the FONA Rx pin high and pulsing FONA DTR low.<br>
<br>
Even longer battery life would possible if I didn't wake the FONA ever 10s to check for a time update (I don't know how long it takes for the FONA to switch to idle) but it's a significant improvement already... and the FONA RI pin could be used to wake the ATmega from sleep. It's entirely feasible this phone could work for 10 days standby on one charge.</div>

			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="./posting.php?mode=reply&amp;f=4&amp;t=1486" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="./viewtopic.php?f=4&amp;t=1486&amp;start=20&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="./viewtopic.php?f=4&amp;t=1486&amp;start=20">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			27 posts
							<ul>
			<li class="arrow previous"><a class="button button-icon-only" href="./viewtopic.php?f=4&amp;t=1486&amp;start=10" rel="prev" role="button"><i class="icon fa-chevron-left fa-fw" aria-hidden="true"></i><span class="sr-only">Previous</span></a></li>
				<li><a class="button" href="./viewtopic.php?f=4&amp;t=1486" role="button">1</a></li>
				<li><a class="button" href="./viewtopic.php?f=4&amp;t=1486&amp;start=10" role="button">2</a></li>
			<li class="active"><span>3</span></li>
	</ul>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="./viewforum.php?f=4" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “Rotary Cell Phone Kit Community Forum”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="./viewforum.php?f=4" class="jumpbox-forum-link"> <span> Rotary Cell Phone Kit Community Forum</span></a></li>
																<li><a href="./viewforum.php?f=5" class="jumpbox-forum-link"> <span> Robotics Technical Discussion</span></a></li>
																<li><a href="./viewforum.php?f=6" class="jumpbox-forum-link"> <span> General Open Source Discussion</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
									<span class="crumb"><a href="./index.php" data-navbar-reference="index"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Board index</span></a></span>					</li>
		
				<li class="rightside">All times are <span title="UTC">UTC</span></li>
							<li class="rightside">
				<a href="./ucp.php?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete cookies</span>
				</a>
			</li>
																<li class="rightside" data-last-responsive="true">
				<a href="./memberlist.php?mode=contactadmin" role="menuitem">
					<i class="icon fa-envelope fa-fw" aria-hidden="true"></i><span>Contact us</span>
				</a>
			</li>
			</ul>

	</div>
</div>

	<div class="copyright">
				<p class="footer-row">
			<span class="footer-copyright">Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited</span>
		</p>
						<p class="footer-row" role="menu">
			<a class="footer-link" href="./ucp.php?mode=privacy" title="Privacy" role="menuitem">
				<span class="footer-link-text">Privacy</span>
			</a>
			|
			<a class="footer-link" href="./ucp.php?mode=terms" title="Terms" role="menuitem">
				<span class="footer-link-text">Terms</span>
			</a>
		</p>
					</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	<img src="/forum/app.php/cron/cron.task.core.tidy_warnings" width="1" height="1" alt="cron" /></div>

<script src="./assets/javascript/jquery-3.4.1.min.js?assets_version=6"></script>
<script src="./assets/javascript/core.js?assets_version=6"></script>



<script src="./styles/prosilver/template/forum_fn.js?assets_version=6"></script>
<script src="./styles/prosilver/template/ajax.js?assets_version=6"></script>



</body>
</html>
